cat: ansible-playbook: No such file or directory
---
 - hosts: esxi
   become_user: laszlo

   tasks:
   - name: Dump all of the commands run by users in the shell log file on ESXi into a file named search_result.
     shell: awk '{print $3,$4,$5}' /var/log/shell.log > /tmp/search_result.txt

   - name: Dump the user names into a file named user_list.
     shell: grep -i '\[' /tmp/search_result.txt > /tmp/user_list.txt
     shell: awk '{print substr($1, 2, length($1)-3)} END{print "User", substr($1, 2, length($1)-3), "appears", NR, "times."}' /tmp/user_list.txt > /tmp/user_list2.txt
     shell: sort /tmp/user_list2.txt | uniq > /tmp/user_list3.txt
     shell: uniq -c /tmp/user_list2.txt > /tmp/user_list4.txt
     shell: awk 'BEGIN{print "The following remote users have appeared in shell.log.\n------------------------------------------------------"} {print $2, "ran", $1, "commands in the shell."}' /tmp/user_list4.txt > /tmp/user_list5.txt

========================

---
 - hosts: esxi
   become_user: laszlo

   tasks:
   - name: Copy shell.log to the /tmp directory on the ESXi server.
     ansible.builtin.copy:
       src: /var/log/shell.log
       dest: /tmp/ESXi-shell.log
       remote_src: yes

   - name: Copy files in the /tmp directory on the ESXi server to the /tmp directory on the Ansible controller node.
     ansible.builtin.fetch:
       src: /tmp/ESXi-shell.log
       dest: /tmp/
       flat: yes

 # The awk command below isn't matching any results when I add match($3, /\[/) to it. Maybe grepping those lines will be better.
   - name: Dump user names from the ESXi-shell file on the ESXi server into a stats file named ESXi-temp.
     shell: awk '{print substr($3, 2, length($3)-3)}' /tmp/ESXi-shell.log > /tmp/ESXi-temp-stats.log

   - name: Copy user login info fromthe ESXi-temp-stats.log file into the ESXi-stats.log.
     shell: sort /tmp/ESXi-temp-stats.log | uniq -c > /tmp/ESXi-stats.log

===========================================

[name]:/etc/ansible$ cat ESXi-log-aggregator.yml
---
 - hosts: esxi
   become_user: laszlo

   tasks:
   - name: Copy shell.log to the /tmp directory on the ESXi server.
     ansible.builtin.copy:
       src: /var/log/shell.log
       dest: /tmp/ESXi-shell.log
       remote_src: yes

   - name: Copy files in the /tmp directory on the ESXi server to the /tmp directory on the Ansible controller node.
     ansible.builtin.fetch:
       src: /tmp/ESXi-shell.log
       dest: /tmp/
       flat: yes

   - name: Dump only users into the ESXi-shell.log file.
     shell: cat /tmp/ESXi-shell.log | grep ' \[' > /tmp/ESXi-temp-stats.log

   - name: Dump user names from the ESXi-shell file on the ESXi server into a stats file named ESXi-temp.
     shell: awk '{print substr($3, 2, length($3)-3)}' /tmp/ESXi-temp-stats.log > /tmp/ESXi-temp-stats-2.log

   - name: Copy user login info fromthe ESXi-temp-stats.log file into the ESXi-stats.log.
     shell: cat /tmp/ESXi-temp-stats-2.log | uniq -c > /tmp/ESXi-temp-stats-3.log

   - name: Put user numbers in ESXi-stats.log.
     shell: awk 'BEGIN {print "User shell use\n--------------"} {print "The " $2 " user ran " $1 " commands in the terminal."}' /tmp/ESXi-temp-stats-3.log > /tmp/ESXi-stats.log

   - name: Put user command statistics in ESXi-stats.log.
     shell: awk '{!($1=$2=$3="")}' /tmp/ESXi-temp-stats.log > /tmp/ESXi.temp-stats-2.log

===================

---
 - hosts: esxi
   become_user: laszlo

   tasks:
   - name: Copy shell.log to the /tmp directory on the ESXi server.
     ansible.builtin.copy:
       src: /var/log/shell.log
       dest: /tmp/ESXi-shell.log
       remote_src: yes

   - name: Copy files in the /tmp directory on the ESXi server to the /tmp directory on the Ansible controller node.
     ansible.builtin.fetch:
       src: /tmp/ESXi-shell.log
       dest: /tmp/
       flat: yes

   - name: Dump only users into the ESXi-shell.log file.
     shell: cat /tmp/ESXi-shell.log | grep ' \[' > /tmp/ESXi-temp-stats.log

   - name: Dump user names from the ESXi-shell file on the ESXi server into a stats file named ESXi-temp.
     shell: awk '{print substr($3, 2, length($3)-3)}' /tmp/ESXi-temp-stats.log > /tmp/ESXi-temp-stats-2.log

   - name: Copy user login info fromthe ESXi-temp-stats.log file into the ESXi-stats.log.
     shell: cat /tmp/ESXi-temp-stats-2.log | uniq -c > /tmp/ESXi-temp-stats-3.log

   - name: Put user numbers in ESXi-stats.log.
     shell: awk 'BEGIN {print "User shell use\n--------------"} {print "The " $2 " user ran " $1 " commands in the terminal."}' /tmp/ESXi-temp-stats-3.log > /tmp/ESXi-stats.log

   - name: Put user command statistics in ESXi-stats.log.
     shell: awk '{$1=$2=$3=""; print $0}' /tmp/ESXi-temp-stats.log > /tmp/ESXi-temp-stats-2.log

   - name: Add a line of text to ESXi-stats-log file.
     shell: printf '\nThese users ran the following commands in the terminal
                    \n------------------------------------------------------\n' >> /tmp/ESXi-stats.log

   - name: Dump all of the commands into the ESXi-stats.log file.
     shell: cat /tmp/ESXi-temp-stats-2.log | sort | uniq >> /tmp/ESXi-stats.log

==============================

---
 - hosts: esxi
   become_user: laszlo

   tasks:
   - name: Copying the /var/log/shell.log file to the /tmp directory on the ESXi server.
     ansible.builtin.copy:
       src: /var/log/shell.log
       dest: /tmp/ESXi-shell.log
       remote_src: yes

   - name: Fetching the ESXi-shell.log file from the /tmp directory on the ESXi server to the /tmp directory on the Ansible controller node.
     ansible.builtin.fetch:
       src: /tmp/ESXi-shell.log
       dest: /tmp/
       flat: yes

   - name: Running Ansible shell commands having to do with general user stats.
     shell: | # Execute the following shell commands.
            cat /tmp/ESXi-shell.log | grep ' \[' > /tmp/ESXi-temp-stats.log
            awk '{print substr($3, 2, length($3)-3)}' /tmp/ESXi-temp-stats.log > /tmp/ESXi-temp-stats-2.log
            cat /tmp/ESXi-temp-stats-2.log | uniq -c > /tmp/ESXi-temp-stats-3.log
            printf 'Shell use\n' > /tmp/ESXi-stats.log
            printf '---------\n' >> /tmp/ESXi-stats.log
            awk '{print "The " $2 " user ran " $1 " commands in the terminal."}' /tmp/ESXi-temp-stats-3.log >> /tmp/ESXi-stats.log

   - name: Running Ansible shell commands having to do with user commands.
     shell: | # Execute the following shell commands.
            awk '{$1=$2=$3=""; print $0}' /tmp/ESXi-temp-stats.log > /tmp/ESXi-temp-stats-2.log
            printf '\nThese users ran the following commands in the terminal' >> /tmp/ESXi-stats.log
            printf '\n------------------------------------------------------\n' >> /tmp/ESXi-stats.log
            cat /tmp/ESXi-temp-stats-2.log | sort | uniq >> /tmp/ESXi-stats.log
~                                                                                    

===========================================================

laszlo@DESKTOP-EAKH2SC:/etc/ansible$ cat ESXi-log-aggregator.yml
---
 - hosts: esxi
   become_user: laszlo

   tasks:
   - name: Copying the /var/log/shell.log file to the /tmp directory on the ESXi server.
     ansible.builtin.copy:
       src: /var/log/shell.log
       dest: /tmp/ESXi-shell.log
       remote_src: yes

   - name: Running Ansible shell commands having to do with general user stats.
     shell: | # Execute the following shell commands.
            cat /tmp/ESXi-shell.log | grep ' \[' > /tmp/temp-file1.log
            awk '{print substr($3, 2, length($3)-3)}' /tmp/temp-file1.log > /tmp/temp-file2.log
            cat /tmp/temp-file2.log | uniq -c > /tmp/temp-file3.log
            printf 'Shell use\n' > /tmp/ESXi-stats.log
            printf '---------\n' >> /tmp/ESXi-stats.log
            awk '{print "The " $2 " user ran " $1 " commands in the terminal."}' /tmp/temp-file3.log >> /tmp/ESXi-stats.log

   - name: Running Ansible shell commands having to do with user commands.
     shell: | # Execute the following shell commands.
            awk '{$1=$2=$3=""; print $0}' /tmp/temp-file1.log > /tmp/temp-file2.log
            printf '\nThese users ran the following commands in the terminal' >> /tmp/ESXi-stats.log
            printf '\n------------------------------------------------------\n' >> /tmp/ESXi-stats.log
            cat /tmp/temp-file2.log | sort | uniq >> /tmp/ESXi-stats.log

   - name: Fetching the ESXi-shell.log file from the /tmp directory on the ESXi server to the /tmp directory on the Ansible controller node.
     ansible.builtin.fetch:
       src: /tmp/ESXi-shell.log
       dest: /tmp/
       flat: yes

   - name: Fetching the ESXi-stats.log file from the /tmp directory on the ESXi server to the /tmp directory on the Ansible controller node.
     ansible.builtin.fetch:
       src: /tmp/ESXi-stats.log
       dest: /tmp/
       flat: yes

   - name: Deleting temporary files on the ESXi server.
     file:
       path: '{{ item }}'
       state: absent
     with_items:
       - /tmp/ESXi-shell.log
       - /tmp/ESXi-stats.log
       - /tmp/temp-file1.log
       - /tmp/temp-file2.log
       - /tmp/temp-file3.log
